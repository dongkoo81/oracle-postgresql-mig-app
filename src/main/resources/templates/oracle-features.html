<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Oracle íŠ¹í™” ê¸°ëŠ¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
        .header h1 { margin-bottom: 10px; }
        .back-link { display: inline-block; color: white; text-decoration: none; margin-bottom: 10px; opacity: 0.9; }
        .back-link:hover { opacity: 1; text-decoration: underline; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 8px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .card h3 { color: #333; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #555; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .form-group textarea { resize: vertical; min-height: 80px; font-family: monospace; }
        button { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500; }
        button:hover { background: #5568d3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #28a745; }
        .result.error { border-left-color: #dc3545; background: #fff5f5; }
        .result h4 { margin-bottom: 10px; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table th, table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        table th { background: #f8f9fa; font-weight: 600; color: #555; }
        table tr:hover { background: #f8f9fa; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 3px; font-size: 12px; font-weight: 500; }
        .badge.success { background: #d4edda; color: #155724; }
        .badge.danger { background: #f8d7da; color: #721c24; }
        .tree { margin-left: 20px; }
        .tree-item { padding: 5px 0; }
        .loading { display: none; color: #667eea; margin-top: 10px; }
        .loading.show { display: block; }
        pre { background: #f1f3f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/" class="back-link">â† í™ˆìœ¼ë¡œ</a>
            <h1>ğŸ”§ Oracle íŠ¹í™” ê¸°ëŠ¥</h1>
            <p>Oracle 19cì˜ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ì„¸ìš”</p>
        </div>

        <div class="grid">
            <!-- 1. QueryDSL ë™ì  ê²€ìƒ‰ -->
            <div class="card">
                <h3>ğŸ“¦ ì œí’ˆ ê²€ìƒ‰ (QueryDSL)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> QueryDSL ë™ì  ì¿¼ë¦¬, WHERE ì¡°ê±´ ë™ì  ìƒì„±
                </p>
                <div class="form-group">
                    <label>ì œí’ˆëª…</label>
                    <input type="text" id="search-name" placeholder="ì œí’ˆëª… ì…ë ¥">
                </div>
                <div class="form-group">
                    <label>ìµœì†Œ ê°€ê²©</label>
                    <input type="number" id="search-minPrice" placeholder="0">
                </div>
                <div class="form-group">
                    <label>ìµœëŒ€ ê°€ê²©</label>
                    <input type="number" id="search-maxPrice" placeholder="999999">
                </div>
                <button onclick="searchProducts()">ê²€ìƒ‰</button>
                <div class="loading" id="search-loading">ê²€ìƒ‰ ì¤‘...</div>
                <div id="search-result"></div>
            </div>

            <!-- 2. Stored Function - ì¬ê³  í™•ì¸ -->
            <div class="card">
                <h3>ğŸ“Š ì¬ê³  ê°€ìš©ì„± í™•ì¸ (Stored Function)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> Stored Function (CHECK_PRODUCT_AVAILABLE), RETURN ê°’ ë°˜í™˜
                </p>
                <div class="form-group">
                    <label>ì œí’ˆ ì„ íƒ</label>
                    <select id="stock-productId">
                        <option value="">ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>í•„ìš” ìˆ˜ëŸ‰</label>
                    <input type="number" id="stock-qty" placeholder="ìˆ˜ëŸ‰ ì…ë ¥" value="10">
                </div>
                <button onclick="checkStock()">ì¬ê³  í™•ì¸</button>
                <div class="loading" id="stock-loading">í™•ì¸ ì¤‘...</div>
                <div id="stock-result"></div>
            </div>

            <!-- 3. Stored Procedure - ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚° -->
            <div class="card">
                <h3>ğŸ’° ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚° (Stored Procedure)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> Stored Procedure (CALCULATE_ORDER_TOTAL), OUT íŒŒë¼ë¯¸í„°
                </p>
                <div class="form-group">
                    <label>ì£¼ë¬¸ ì„ íƒ</label>
                    <select id="calc-orderId">
                        <option value="">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <button onclick="calculateTotal()">ê¸ˆì•¡ ê³„ì‚°</button>
                <div class="loading" id="calc-loading">ê³„ì‚° ì¤‘...</div>
                <div id="calc-result"></div>
            </div>

            <!-- 4. CONNECT BY - ìƒì‚° ì´ë ¥ -->
            <div class="card">
                <h3>ğŸ”— ìƒì‚° ì´ë ¥ ì¡°íšŒ (CONNECT BY)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> CONNECT BY ê³„ì¸µ ì¿¼ë¦¬, START WITH, PRIOR (íŠ¸ë¦¬ êµ¬ì¡°)
                </p>
                <div class="form-group">
                    <label>ì£¼ë¬¸ ì„ íƒ</label>
                    <select id="hier-orderId">
                        <option value="">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <button onclick="viewHierarchy()">ì´ë ¥ ì¡°íšŒ</button>
                <div class="loading" id="hier-loading">ì¡°íšŒ ì¤‘...</div>
                <div id="hier-result"></div>
            </div>

            <!-- 5. CLOB - ë¬¸ì„œ ê´€ë¦¬ -->
            <div class="card">
                <h3>ğŸ“„ ë¬¸ì„œ ê´€ë¦¬ (CLOB)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> CLOB (4GB ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸), @Lob ì–´ë…¸í…Œì´ì…˜
                </p>
                <div class="form-group">
                    <label>ì œí’ˆ ì„ íƒ</label>
                    <select id="doc-productId">
                        <option value="">ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¬¸ì„œ ìœ í˜•</label>
                    <select id="doc-type" onchange="loadDocTemplate()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="manual">ì‚¬ìš©ì ë§¤ë‰´ì–¼</option>
                        <option value="spec">ê¸°ìˆ  ì‚¬ì–‘ì„œ</option>
                        <option value="inspection">í’ˆì§ˆ ê²€ì‚¬ ê¸°ë¡</option>
                        <option value="maintenance">ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¬¸ì„œ ì œëª©</label>
                    <input type="text" id="doc-name" placeholder="ë¬¸ì„œ ì œëª©">
                </div>
                <div class="form-group">
                    <label>ë¬¸ì„œ ë‚´ìš© (ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸)</label>
                    <textarea id="doc-content" placeholder="ë¬¸ì„œ ìœ í˜•ì„ ì„ íƒí•˜ë©´ í…œí”Œë¦¿ì´ ë¡œë“œë©ë‹ˆë‹¤..." rows="10"></textarea>
                </div>
                <button onclick="saveDocument()">ë¬¸ì„œ ì €ì¥</button>
                <button onclick="viewDocuments()" style="background: #17a2b8; margin-left: 10px;">ë¬¸ì„œ ì¡°íšŒ</button>
                <div class="loading" id="doc-loading">ì²˜ë¦¬ ì¤‘...</div>
                <div id="doc-result"></div>
            </div>

            <!-- 6. XMLType - ì œí’ˆ ì‚¬ì–‘ -->
            <div class="card">
                <h3>ğŸ“‹ ì œí’ˆ ì‚¬ì–‘ (XMLType)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> XMLType ì»¬ëŸ¼, XML ê²€ì¦, XPath ì¿¼ë¦¬
                </p>
                <div class="form-group">
                    <label>ì œí’ˆ ì„ íƒ</label>
                    <select id="xml-productId" onchange="filterXmlTemplates()">
                        <option value="">ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì‚¬ì–‘ í…œí”Œë¦¿</label>
                    <select id="xml-template" onchange="loadXmlTemplate()">
                        <option value="">ì œí’ˆì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>XML ì‚¬ì–‘ (XSD ê²€ì¦)</label>
                    <textarea id="xml-content" placeholder="ì‚¬ì–‘ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”..." rows="12"></textarea>
                </div>
                <button onclick="validateAndSaveSpec()">ê²€ì¦ í›„ ì €ì¥</button>
                <button onclick="viewSpecs()" style="background: #17a2b8; margin-left: 10px;">ì‚¬ì–‘ ì¡°íšŒ</button>
                <div class="loading" id="xml-loading">ì²˜ë¦¬ ì¤‘...</div>
                <div id="xml-result"></div>
            </div>

            <!-- 7. Materialized View - ì¼ì¼ ìš”ì•½ -->
            <div class="card" style="grid-column: 1 / -1;">
                <h3>ğŸ“ˆ ì¼ì¼ ì£¼ë¬¸ ìš”ì•½ (Materialized View)</h3>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    ğŸ”§ <strong>Oracle ê¸°ëŠ¥:</strong> Materialized View (ë¬¼ë¦¬ì  ì €ì¥), REFRESH ON DEMAND, ì§‘ê³„ ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™”
                </p>
                <button onclick="viewSummary()">ìš”ì•½ ì¡°íšŒ</button>
                <button onclick="refreshMView()" style="background: #28a745; margin-left: 10px;">ğŸ”„ MView Refresh</button>
                <div class="loading" id="summary-loading">ì¡°íšŒ ì¤‘...</div>
                <div id="summary-result"></div>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        window.onload = function() {
            loadProducts();
            loadOrders();
        };

        // ì œí’ˆ ëª©ë¡ ë¡œë“œ
        async function loadProducts() {
            try {
                const res = await fetch('/api/products');
                const data = await res.json();
                const products = data.content || data; // í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
                
                ['stock-productId', 'doc-productId', 'xml-productId'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    products.forEach(p => {
                        select.innerHTML += `<option value="${p.productId}">${p.productName} (${p.productCode})</option>`;
                    });
                });
            } catch (e) {
                console.error('ì œí’ˆ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }

        // ì£¼ë¬¸ ëª©ë¡ ë¡œë“œ
        async function loadOrders() {
            try {
                const res = await fetch('/api/orders');
                const data = await res.json();
                const orders = data.content || data; // í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
                
                ['calc-orderId', 'hier-orderId'].forEach(id => {
                    const select = document.getElementById(id);
                    select.innerHTML = '<option value="">ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</option>';
                    orders.forEach(o => {
                        select.innerHTML += `<option value="${o.orderId}">${o.orderNo} (${o.orderDate})</option>`;
                    });
                });
            } catch (e) {
                console.error('ì£¼ë¬¸ ë¡œë“œ ì‹¤íŒ¨:', e);
            }
        }

        // 1. ì œí’ˆ ê²€ìƒ‰
        async function searchProducts() {
            const name = document.getElementById('search-name').value;
            const minPrice = document.getElementById('search-minPrice').value;
            const maxPrice = document.getElementById('search-maxPrice').value;
            
            showLoading('search-loading', true);
            try {
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                if (minPrice) params.append('minPrice', minPrice);
                if (maxPrice) params.append('maxPrice', maxPrice);
                
                const res = await fetch(`/api/test/oracle/querydsl/search?${params}`);
                const products = await res.json();
                
                let html = '<h4>ê²€ìƒ‰ ê²°ê³¼ (' + products.length + 'ê±´)</h4>';
                if (products.length > 0) {
                    html += '<table><tr><th>ì œí’ˆì½”ë“œ</th><th>ì œí’ˆëª…</th><th>ë‹¨ê°€</th><th>ë“±ë¡ì¼</th></tr>';
                    products.forEach(p => {
                        html += `<tr><td>${p.productCode}</td><td>${p.productName}</td><td>${p.unitPrice?.toLocaleString()}ì›</td><td>${p.createdDate || '-'}</td></tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                showResult('search-result', html);
            } catch (e) {
                showResult('search-result', '<p>ê²€ìƒ‰ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('search-loading', false);
            }
        }

        // 2. ì¬ê³  í™•ì¸
        async function checkStock() {
            const productId = document.getElementById('stock-productId').value;
            const qty = document.getElementById('stock-qty').value;
            
            if (!productId || !qty) {
                alert('ì œí’ˆê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            showLoading('stock-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/function/check-available?productId=${productId}&requiredQty=${qty}`);
                const data = await res.json();
                
                const badge = data.available ? 
                    '<span class="badge success">âœ“ ì¬ê³  ì¶©ë¶„</span>' : 
                    '<span class="badge danger">âœ— ì¬ê³  ë¶€ì¡±</span>';
                
                const html = `<h4>ì¬ê³  í™•ì¸ ê²°ê³¼</h4><p>${badge}</p><p>ìš”ì²­ ìˆ˜ëŸ‰: ${qty}ê°œ</p>`;
                showResult('stock-result', html);
            } catch (e) {
                showResult('stock-result', '<p>í™•ì¸ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('stock-loading', false);
            }
        }

        // 3. ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚°
        async function calculateTotal() {
            const orderId = document.getElementById('calc-orderId').value;
            
            if (!orderId) {
                alert('ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            showLoading('calc-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/procedure/calculate-total/${orderId}`, { method: 'POST' });
                const data = await res.json();
                
                const html = `<h4>ê³„ì‚° ê²°ê³¼</h4>
                    <p><strong>ì£¼ë¬¸ ID:</strong> ${data.orderId || orderId}</p>
                    <p><strong>ì´ ê¸ˆì•¡:</strong> ${data.totalAmount?.toLocaleString() || 0}ì›</p>
                    <p><strong>ìƒíƒœ:</strong> ${data.resultMessage || 'ê³„ì‚° ì™„ë£Œ'}</p>`;
                
                showResult('calc-result', html);
            } catch (e) {
                showResult('calc-result', '<p>ê³„ì‚° ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('calc-loading', false);
            }
        }

        // 4. ìƒì‚° ì´ë ¥ ì¡°íšŒ
        async function viewHierarchy() {
            const orderId = document.getElementById('hier-orderId').value;
            
            if (!orderId) {
                alert('ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            showLoading('hier-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/hierarchy/${orderId}`);
                const history = await res.json();
                
                let html = '<h4>ìƒì‚° ì´ë ¥ (' + history.length + 'ê±´)</h4>';
                if (history.length > 0) {
                    html += '<table><tr><th>í”„ë¡œì„¸ìŠ¤</th><th>ì²˜ë¦¬ì¼ì‹œ</th><th>ë ˆë²¨</th></tr>';
                    history.forEach(h => {
                        const indent = '&nbsp;'.repeat((h.level || 0) * 4);
                        html += `<tr><td>${indent}${h.processName || '-'}</td><td>${h.processDate || '-'}</td><td>${h.level || 0}</td></tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>ìƒì‚° ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                showResult('hier-result', html);
            } catch (e) {
                showResult('hier-result', '<p>ì¡°íšŒ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('hier-loading', false);
            }
        }

        // 5. ë¬¸ì„œ ì €ì¥
        async function saveDocument() {
            const productId = document.getElementById('doc-productId').value;
            const name = document.getElementById('doc-name').value;
            const content = document.getElementById('doc-content').value;
            
            if (!productId || !name || !content) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            showLoading('doc-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/clob/save?productId=${productId}&content=${encodeURIComponent(content)}`, { method: 'POST' });
                const data = await res.json();
                
                const html = `<h4>ì €ì¥ ì™„ë£Œ</h4>
                    <p><strong>ë¬¸ì„œ ID:</strong> ${data.docId}</p>
                    <p><strong>ë‚´ìš© ê¸¸ì´:</strong> ${data.contentLength}ì</p>
                    <p class="badge success">CLOB íƒ€ì…ìœ¼ë¡œ ì €ì¥ë¨</p>`;
                
                showResult('doc-result', html);
            } catch (e) {
                showResult('doc-result', '<p>ì €ì¥ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('doc-loading', false);
            }
        }

        // 5-1. ë¬¸ì„œ í…œí”Œë¦¿ ë¡œë“œ
        function loadDocTemplate() {
            const type = document.getElementById('doc-type').value;
            const templates = {
                'manual': `=== ì‚¬ìš©ì ë§¤ë‰´ì–¼ ===

1. ì œí’ˆ ê°œìš”
   - ì œí’ˆëª…: 
   - ëª¨ë¸ë²ˆí˜¸: 
   - ì œì¡°ì¼ì: 

2. ì•ˆì „ ì£¼ì˜ì‚¬í•­
   - ê²½ê³ ì‚¬í•­
   - ì£¼ì˜ì‚¬í•­

3. ì‚¬ìš© ë°©ë²•
   - ì„¤ì¹˜ ë°©ë²•
   - ì‘ë™ ë°©ë²•
   - ìœ ì§€ë³´ìˆ˜ ë°©ë²•

4. ë¬¸ì œ í•´ê²°
   - ì¼ë°˜ì ì¸ ë¬¸ì œ
   - í•´ê²° ë°©ë²•

5. ê¸°ìˆ  ì§€ì›
   - ì—°ë½ì²˜
   - ë³´ì¦ ì •ë³´`,
                'spec': `=== ê¸°ìˆ  ì‚¬ì–‘ì„œ ===

1. ì œí’ˆ ì •ë³´
   - ì œí’ˆëª…: 
   - ì œí’ˆì½”ë“œ: 
   - ë²„ì „: 

2. ê¸°ìˆ  ì‚¬ì–‘
   - í¬ê¸°: 
   - ë¬´ê²Œ: 
   - ì¬ì§ˆ: 
   - ì„±ëŠ¥: 

3. í™˜ê²½ ì¡°ê±´
   - ì‘ë™ ì˜¨ë„: 
   - ë³´ê´€ ì˜¨ë„: 
   - ìŠµë„: 

4. ì¸ì¦ ë° ê·œê²©
   - ì¸ì¦ë²ˆí˜¸: 
   - ì¤€ìˆ˜ ê·œê²©: 

5. ë¹„ê³ 
   - íŠ¹ì´ì‚¬í•­`,
                'inspection': `=== í’ˆì§ˆ ê²€ì‚¬ ê¸°ë¡ ===

1. ê²€ì‚¬ ì •ë³´
   - ê²€ì‚¬ì¼ì: 
   - ê²€ì‚¬ì: 
   - ê²€ì‚¬ í•­ëª©: 

2. ì™¸ê´€ ê²€ì‚¬
   - ìƒíƒœ: 
   - ê²°í•¨ ì—¬ë¶€: 
   - ë¹„ê³ : 

3. ì¹˜ìˆ˜ ê²€ì‚¬
   - ì¸¡ì •ê°’: 
   - í—ˆìš© ì˜¤ì°¨: 
   - í•©ê²© ì—¬ë¶€: 

4. ì„±ëŠ¥ ê²€ì‚¬
   - í…ŒìŠ¤íŠ¸ í•­ëª©: 
   - ì¸¡ì • ê²°ê³¼: 
   - íŒì •: 

5. ì¢…í•© íŒì •
   - í•©ê²©/ë¶ˆí•©ê²©: 
   - ì¡°ì¹˜ì‚¬í•­: `,
                'maintenance': `=== ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ ===

1. ì •ê¸° ì ê²€ í•­ëª©
   - ì¼ì¼ ì ê²€: 
   - ì£¼ê°„ ì ê²€: 
   - ì›”ê°„ ì ê²€: 

2. ì†Œëª¨í’ˆ êµì²´
   - êµì²´ ì£¼ê¸°: 
   - êµì²´ ë°©ë²•: 
   - ê¶Œì¥ ë¶€í’ˆ: 

3. ì²­ì†Œ ë° ê´€ë¦¬
   - ì²­ì†Œ ë°©ë²•: 
   - ì£¼ì˜ì‚¬í•­: 

4. ê³ ì¥ ì§„ë‹¨
   - ì¦ìƒë³„ ì›ì¸: 
   - í•´ê²° ë°©ë²•: 

5. ë³´ê´€ ë°©ë²•
   - ì¥ê¸° ë³´ê´€ ì‹œ: 
   - ì£¼ì˜ì‚¬í•­: `
            };
            
            const content = templates[type] || '';
            document.getElementById('doc-content').value = content;
            if (type) {
                document.getElementById('doc-name').value = type === 'manual' ? 'ì‚¬ìš©ì ë§¤ë‰´ì–¼' :
                    type === 'spec' ? 'ê¸°ìˆ  ì‚¬ì–‘ì„œ' :
                    type === 'inspection' ? 'í’ˆì§ˆ ê²€ì‚¬ ê¸°ë¡' : 'ìœ ì§€ë³´ìˆ˜ ê°€ì´ë“œ';
            }
        }

        // 5-2. ë¬¸ì„œ ì¡°íšŒ
        async function viewDocuments() {
            const productId = document.getElementById('doc-productId').value;
            
            if (!productId) {
                alert('ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            showLoading('doc-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/documents/product/${productId}`);
                const docs = await res.json();
                
                let html = '<h4>ë¬¸ì„œ ëª©ë¡ (' + docs.length + 'ê±´)</h4>';
                if (docs.length > 0) {
                    html += '<table><tr><th>ë¬¸ì„œëª…</th><th>ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°</th><th>ë“±ë¡ì¼</th></tr>';
                    docs.forEach(d => {
                        const preview = (d.docContent || '').substring(0, 50) + '...';
                        html += `<tr><td>${d.docName || '-'}</td><td>${preview}</td><td>${d.createdDate || '-'}</td></tr>`;
                    });
                    html += '</table>';
                } else {
                    html += '<p>ë“±ë¡ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                showResult('doc-result', html);
            } catch (e) {
                showResult('doc-result', '<p>ì¡°íšŒ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('doc-loading', false);
            }
        }

        // 6. XML ì‚¬ì–‘ ì €ì¥ (ê²€ì¦ í¬í•¨)
        async function validateAndSaveSpec() {
            const productId = document.getElementById('xml-productId').value;
            const xmlContent = document.getElementById('xml-content').value;
            
            if (!productId || !xmlContent) {
                alert('ì œí’ˆê³¼ XML ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            // ê°„ë‹¨í•œ XML ê²€ì¦
            if (!xmlContent.trim().startsWith('<spec>') || !xmlContent.trim().endsWith('</spec>')) {
                alert('âŒ XML í˜•ì‹ ì˜¤ë¥˜: <spec>ë¡œ ì‹œì‘í•˜ê³  </spec>ë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤');
                return;
            }
            
            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            if (!xmlContent.includes('<version>') || !xmlContent.includes('<category>')) {
                alert('âŒ í•„ìˆ˜ í•„ë“œ ëˆ„ë½: version, categoryëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤');
                return;
            }
            
            showLoading('xml-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/xml/save?productId=${productId}&xmlContent=${encodeURIComponent(xmlContent)}`, { method: 'POST' });
                const data = await res.json();
                
                const html = `<h4>ì €ì¥ ì™„ë£Œ</h4>
                    <p><strong>ì‚¬ì–‘ ID:</strong> ${data.specId}</p>
                    <p class="badge success">âœ“ XML ê²€ì¦ í†µê³¼</p>
                    <p class="badge success">XMLTypeìœ¼ë¡œ ì €ì¥ë¨</p>
                    <pre>${xmlContent}</pre>`;
                
                showResult('xml-result', html);
            } catch (e) {
                showResult('xml-result', '<p>ì €ì¥ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('xml-loading', false);
            }
        }

        // 6-0. ì œí’ˆì— ë§ëŠ” í…œí”Œë¦¿ í•„í„°ë§
        function filterXmlTemplates() {
            const productId = document.getElementById('xml-productId').value;
            const select = document.getElementById('xml-template');
            
            if (!productId) {
                select.innerHTML = '<option value="">ì œí’ˆì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>';
                return;
            }
            
            // ì œí’ˆëª…ìœ¼ë¡œ í…œí”Œë¦¿ ë§¤ì¹­
            const productText = document.getElementById('xml-productId').options[document.getElementById('xml-productId').selectedIndex].text.toLowerCase();
            
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            
            if (productText.includes('engine') || productText.includes('ì—”ì§„')) {
                select.innerHTML += '<option value="engine">ì—”ì§„ ë¶€í’ˆ</option>';
            } else if (productText.includes('transmission') || productText.includes('ë³€ì†ê¸°')) {
                select.innerHTML += '<option value="transmission">ë³€ì†ê¸° ë¶€í’ˆ</option>';
            } else if (productText.includes('brake') || productText.includes('ë¸Œë ˆì´í¬')) {
                select.innerHTML += '<option value="brake">ë¸Œë ˆì´í¬ ë¶€í’ˆ</option>';
            } else {
                // ê¸°ë³¸: ëª¨ë“  í…œí”Œë¦¿ í‘œì‹œ
                select.innerHTML += '<option value="engine">ì—”ì§„ ë¶€í’ˆ</option>';
                select.innerHTML += '<option value="transmission">ë³€ì†ê¸° ë¶€í’ˆ</option>';
                select.innerHTML += '<option value="brake">ë¸Œë ˆì´í¬ ë¶€í’ˆ</option>';
                select.innerHTML += '<option value="electronic">ì „ì ë¶€í’ˆ</option>';
            }
        }

        // 6-1. XML í…œí”Œë¦¿ ë¡œë“œ
        function loadXmlTemplate() {
            const type = document.getElementById('xml-template').value;
            const templates = {
                'engine': `<spec>
  <version>1.0</version>
  <category>Engine</category>
  <properties>
    <displacement>2000cc</displacement>
    <power>150HP</power>
    <torque>200Nm</torque>
    <fuelType>Gasoline</fuelType>
    <cylinders>4</cylinders>
  </properties>
  <dimensions>
    <length>600mm</length>
    <width>500mm</width>
    <height>700mm</height>
    <weight>180kg</weight>
  </dimensions>
  <materials>
    <block>Aluminum Alloy</block>
    <head>Cast Iron</head>
  </materials>
  <certifications>
    <emission>Euro 6</emission>
    <safety>ISO 9001</safety>
  </certifications>
</spec>`,
                'transmission': `<spec>
  <version>1.0</version>
  <category>Transmission</category>
  <properties>
    <type>Automatic</type>
    <gears>8</gears>
    <maxTorque>350Nm</maxTorque>
    <oilCapacity>7L</oilCapacity>
  </properties>
  <dimensions>
    <length>500mm</length>
    <width>400mm</width>
    <height>300mm</height>
    <weight>85kg</weight>
  </dimensions>
  <materials>
    <housing>Aluminum</housing>
    <gears>Hardened Steel</gears>
  </materials>
  <performance>
    <efficiency>95%</efficiency>
    <shiftTime>0.2s</shiftTime>
  </performance>
</spec>`,
                'brake': `<spec>
  <version>1.0</version>
  <category>Brake</category>
  <properties>
    <type>Disc Brake</type>
    <diameter>320mm</diameter>
    <thickness>28mm</thickness>
    <material>Carbon Ceramic</material>
  </properties>
  <dimensions>
    <outerDiameter>320mm</outerDiameter>
    <innerDiameter>140mm</innerDiameter>
    <thickness>28mm</thickness>
    <weight>5.5kg</weight>
  </dimensions>
  <performance>
    <maxTemp>800C</maxTemp>
    <friction>0.45</friction>
    <lifespan>80000km</lifespan>
  </performance>
  <certifications>
    <standard>ECE R90</standard>
    <quality>ISO/TS 16949</quality>
  </certifications>
</spec>`,
                'electronic': `<spec>
  <version>1.0</version>
  <category>Electronic</category>
  <properties>
    <type>ECU</type>
    <processor>ARM Cortex-M4</processor>
    <memory>2MB Flash</memory>
    <voltage>12V</voltage>
    <current>5A</current>
  </properties>
  <dimensions>
    <length>150mm</length>
    <width>100mm</width>
    <height>40mm</height>
    <weight>0.5kg</weight>
  </dimensions>
  <environment>
    <operatingTemp>-40C to 85C</operatingTemp>
    <storageTemp>-40C to 125C</storageTemp>
    <humidity>5% to 95%</humidity>
    <waterproof>IP67</waterproof>
  </environment>
  <certifications>
    <emc>ISO 11452</emc>
    <automotive>AEC-Q100</automotive>
  </certifications>
</spec>`
            };
            
            const content = templates[type] || '';
            document.getElementById('xml-content').value = content;
        }

        // 6-2. ì‚¬ì–‘ ì¡°íšŒ
        async function viewSpecs() {
            const productId = document.getElementById('xml-productId').value;
            
            if (!productId) {
                alert('ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”');
                return;
            }
            
            showLoading('xml-loading', true);
            try {
                const res = await fetch(`/api/test/oracle/specs/product/${productId}`);
                const specs = await res.json();
                
                let html = '<h4>ì œí’ˆ ì‚¬ì–‘ (' + specs.length + 'ê±´)</h4>';
                if (specs.length > 0) {
                    specs.forEach(s => {
                        html += `<div style="margin-top:15px; padding:10px; background:#f8f9fa; border-radius:4px;">
                            <p><strong>ì‚¬ì–‘ ID:</strong> ${s.specId}</p>
                            <p><strong>ë²„ì „:</strong> ${s.version || '-'}</p>
                            <p><strong>ë“±ë¡ì¼:</strong> ${s.createdDate || '-'}</p>
                            <pre style="margin-top:10px;">${s.specXml || '-'}</pre>
                        </div>`;
                    });
                } else {
                    html += '<p>ë“±ë¡ëœ ì‚¬ì–‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                showResult('xml-result', html);
            } catch (e) {
                showResult('xml-result', '<p>ì¡°íšŒ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('xml-loading', false);
            }
        }

        // 7. ì¼ì¼ ìš”ì•½ ì¡°íšŒ
        async function viewSummary() {
            showLoading('summary-loading', true);
            try {
                const res = await fetch('/api/test/oracle/materialized-view');
                const summary = await res.json();
                
                let html = '<h4>ì¼ì¼ ì£¼ë¬¸ ìš”ì•½ (' + summary.length + 'ê±´)</h4>';
                if (summary.length > 0) {
                    html += '<table><tr><th>ë‚ ì§œ</th><th>ì£¼ë¬¸ ê±´ìˆ˜</th><th>ì´ ê¸ˆì•¡</th></tr>';
                    summary.forEach(s => {
                        html += `<tr><td>${s.summaryDate || '-'}</td><td>${s.totalOrders || 0}ê±´</td><td>${s.totalAmount?.toLocaleString() || 0}ì›</td></tr>`;
                    });
                    html += '</table>';
                    html += '<p style="margin-top:10px;color:#666;font-size:12px;">* Materialized Viewì—ì„œ ì¡°íšŒë¨</p>';
                } else {
                    html += '<p>ìš”ì•½ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                showResult('summary-result', html);
            } catch (e) {
                showResult('summary-result', '<p>ì¡°íšŒ ì‹¤íŒ¨: ' + e.message + '</p>', true);
            } finally {
                showLoading('summary-loading', false);
            }
        }

        // 8. Materialized View Refresh
        async function refreshMView() {
            showLoading('summary-loading', true);
            try {
                const res = await fetch('/api/test/oracle/materialized-view/refresh', { method: 'POST' });
                const data = await res.json();
                alert('âœ… Materialized Viewê°€ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤!');
                viewSummary(); // ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì¡°íšŒ
            } catch (e) {
                alert('âŒ ê°±ì‹  ì‹¤íŒ¨: ' + e.message);
            } finally {
                showLoading('summary-loading', false);
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function showResult(elementId, html, isError = false) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="result ${isError ? 'error' : ''}">${html}</div>`;
        }

        function showLoading(elementId, show) {
            const el = document.getElementById(elementId);
            if (show) {
                el.classList.add('show');
            } else {
                el.classList.remove('show');
            }
        }
    </script>
</body>
</html>
