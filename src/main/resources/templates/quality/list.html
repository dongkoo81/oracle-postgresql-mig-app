<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í’ˆì§ˆê²€ì‚¬ ì´ë ¥ - MES</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .badge { padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .badge-pass { background: #d4edda; color: #155724; }
        .badge-fail { background: #f8d7da; color: #721c24; }
        .badge-pending { background: #fff3cd; color: #856404; }
        .filter-tabs { margin: 20px 0; display: flex; gap: 10px; }
        .filter-tabs button { padding: 10px 20px; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 4px; }
        .filter-tabs button.active { background: #667eea; color: white; border-color: #667eea; }
        .partition-info { background: #e7f3ff; padding: 15px; border-radius: 4px; margin-bottom: 20px; border-left: 4px solid #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“‹ í’ˆì§ˆê²€ì‚¬ ì´ë ¥ (íŒŒí‹°ì…˜ í…Œì´ë¸”)</h1>
        
        <div class="partition-info">
            <strong>ğŸ”§ Oracle Partition Table ê¸°ëŠ¥</strong><br>
            Range(ì›”ë³„) + List(ê²°ê³¼ë³„) Composite Partitionìœ¼ë¡œ ë°ì´í„° ë¶„ì‚° ì €ì¥
        </div>
        
        <div class="actions">
            <a th:href="@{/products}" class="btn">ì œí’ˆ ê´€ë¦¬</a>
            <a th:href="@{/orders}" class="btn">ì‘ì—…ì§€ì‹œ ê´€ë¦¬</a>
            <a th:href="@{/}" class="btn">í™ˆìœ¼ë¡œ</a>
        </div>
        
        <div class="filter-tabs">
            <button onclick="filterResult('ALL')" class="active" id="btn-all">ì „ì²´</button>
            <button onclick="filterResult('PASS')" id="btn-pass">í•©ê²© (PASS)</button>
            <button onclick="filterResult('FAIL')" id="btn-fail">ë¶ˆí•©ê²© (FAIL)</button>
            <button onclick="filterResult('PENDING')" id="btn-pending">ëŒ€ê¸° (PENDING)</button>
        </div>
        
        <table class="table">
            <thead>
                <tr>
                    <th>ê²€ì‚¬ ID</th>
                    <th>ì œí’ˆ ID</th>
                    <th>ì£¼ë¬¸ ID</th>
                    <th>ê²€ì‚¬ì¼</th>
                    <th>ê²°ê³¼</th>
                    <th>ë¶ˆëŸ‰ ìˆ˜</th>
                    <th>ê²€ì‚¬ì</th>
                    <th>ë¹„ê³ </th>
                </tr>
            </thead>
            <tbody id="inspection-tbody">
                <tr th:each="inspection : ${inspections}">
                    <td th:text="${inspection.inspectionId}"></td>
                    <td th:text="${inspection.productId}"></td>
                    <td th:text="${inspection.orderId}"></td>
                    <td th:text="${#temporals.format(inspection.inspectionDate, 'yyyy-MM-dd')}"></td>
                    <td>
                        <span th:class="${'badge badge-' + #strings.toLowerCase(inspection.result)}" 
                              th:text="${inspection.result}"></span>
                    </td>
                    <td th:text="${inspection.defectCount}"></td>
                    <td th:text="${inspection.inspectorName}"></td>
                    <td th:text="${inspection.notes}"></td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <script>
        function filterResult(result) {
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.filter-tabs button').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + result.toLowerCase()).classList.add('active');
            
            // API í˜¸ì¶œ
            const url = result === 'ALL' 
                ? '/api/quality' 
                : '/api/quality/result/' + result;
            
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('inspection-tbody');
                    tbody.innerHTML = '';
                    
                    data.forEach(item => {
                        const badgeClass = 'badge-' + item.result.toLowerCase();
                        tbody.innerHTML += `
                            <tr>
                                <td>${item.inspectionId}</td>
                                <td>${item.productId}</td>
                                <td>${item.orderId || '-'}</td>
                                <td>${item.inspectionDate}</td>
                                <td><span class="badge ${badgeClass}">${item.result}</span></td>
                                <td>${item.defectCount}</td>
                                <td>${item.inspectorName}</td>
                                <td>${item.notes || '-'}</td>
                            </tr>
                        `;
                    });
                });
        }
    </script>
</body>
</html>
