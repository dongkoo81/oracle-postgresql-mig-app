<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.autoever.mes.mapper.HistoryMapper">

    <!-- Oracle CONNECT BY 계층 쿼리 -->
    <select id="findHierarchyByOrderId" resultType="com.autoever.mes.domain.history.entity.ProductionHistory">
        SELECT 
            HISTORY_ID as historyId,
            ORDER_ID as orderId,
            PARENT_ID as parentId,
            PROCESS_NAME as processName,
            PROCESS_DATE as processDate
        FROM PRODUCTION_HISTORY
        WHERE ORDER_ID = #{orderId}
        START WITH PARENT_ID IS NULL
        CONNECT BY PRIOR HISTORY_ID = PARENT_ID
        ORDER SIBLINGS BY PROCESS_DATE
    </select>

</mapper>
